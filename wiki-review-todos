#!/bin/bash
# Review outstanding TODOs from vimwiki

JOURNAL_DIR="$HOME/journal"
TODO_FILE="$JOURNAL_DIR/TODO.md"

echo "=== Outstanding TODOs ==="
echo ""

# Check main TODO file
if [ -f "$TODO_FILE" ]; then
    echo "üìã Main TODO List:"
    grep -E '^\s*[-*]\s*\[[ ‚óã‚óê‚óè]\]' "$TODO_FILE" | grep -v '\[‚úì\]' | grep -v '\[X\]' | sed 's/^/  /'
    echo ""
fi

# Check diary entries for TODOs
echo "üìÖ TODOs from Recent Diary Entries:"
find "$JOURNAL_DIR/diary" -name "*.md" -type f -mtime -7 | sort -r | while read -r file; do
    todos=$(grep -E '^\s*[-*]\s*\[[ ‚óã‚óê‚óè]\]' "$file" | grep -v '\[‚úì\]' | grep -v '\[X\]')
    if [ -n "$todos" ]; then
        date=$(basename "$file" .md)
        echo "  [$date]"
        echo "$todos" | sed 's/^/    /'
        echo ""
    fi
done

# Check notes for TODOs
if [ -d "$JOURNAL_DIR/notes" ]; then
    echo "üìù TODOs from Notes:"
    find "$JOURNAL_DIR/notes" -name "*.md" -type f | while read -r file; do
        todos=$(grep -E '^\s*[-*]\s*\[[ ‚óã‚óê‚óè]\]' "$file" | grep -v '\[‚úì\]' | grep -v '\[X\]')
        if [ -n "$todos" ]; then
            note=$(basename "$file" .md)
            echo "  [$note]"
            echo "$todos" | sed 's/^/    /'
            echo ""
        fi
    done
fi

# Summary count
total_incomplete=$(grep -rh -E '^\s*[-*]\s*\[[ ‚óã‚óê‚óè]\]' "$JOURNAL_DIR" --include="*.md" | grep -v '\[‚úì\]' | grep -v '\[X\]' | wc -l)
echo "=== Summary: $total_incomplete incomplete TODOs ==="
